apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kms-system
spec:
  interval: 10m
  releaseName: kms-system
  chart:
    spec:
      chart: ./tools/charts/generic
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
  install:
    createNamespace: false
    remediation:
      retries: -1
      remediateLastFailure: true
  upgrade:
    remediation:
      retries: -1
      remediateLastFailure: true
  values:
    resources:
      serviceaccount-remotesync:
        apiVersion: v1
        kind: ServiceAccount
        metadata:
          name: kms-system-remote-sync
          namespace: flux-system
      cluster-secret-store-vault-backend-common:
        apiVersion: external-secrets.io/v1
        kind: ClusterSecretStore
        metadata:
          name: vault-backend-worker01
        spec:
          provider:
            kubernetes:
              remoteNamespace: linkerd
              auth:
                # kubeconfig auth is not supported in your deployed ESO version.
                # serviceAccount auth here only works for in-cluster access. For true cross-cluster
                # secret sync, deploy ESO in the target cluster or use an intermediate store (e.g. Vault).
                serviceAccount:
                  name: kms-system-remote-sync
                  namespace: flux-system
              server:
                url: https://api.worker01.kms.shoot.gardener.cc-one.showroom.apeirora.eu
                caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQ1ekNDQWsrZ0F3SUJBZ0lSQUxHTlFoZ1BLeGpXK095VjAxRmxUK3d3RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTWpVeE1qQXhNRGt5TWpFd1doY05NelV4TWpBeE1Ea3lNekV3V2pBTgpNUXN3Q1FZRFZRUURFd0pqWVRDQ0FhSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnR1BBRENDQVlvQ2dnR0JBTVlQCjZxamMzOWlsdVFtNnVxWER0N2FDZkVZbkZZb3Zrd3Nsd09YZlRCNzFsbWlJdFJVUXl5ektFL3BVMTh1eElHL2YKczMzdUdIUzFHblQ3S004aWZ6NDY4c3Z5WVN1QnlSZEFVU3FzR0IvR0RXWHVyRDhEZStxNHBRNGZEWUN5bnA4LwpGdmp1bmJobWtrTlJsQ1pHNkFZQkJLTEhGZXlhTFdJcUt0SXliSmU4VkxOTUZtVWVxOW9ybUVlWHc0MzRRRE5oClhFOGZDSG5jdnNWQWpmdEdjWjVZeTl1dXQrZlFvMWVsQ1diQjJmbHJvZTYwdEZOSE0vZTROdkpweHJKWS9RbncKU1FnQ3p6ZksyVFJWeHFlS0FVY0ZYNklQY0F3NHBiajRZU3Bha0hVZkR1bFc4bXMydzBWdFdXYmlMOGp5VW54egpzb093b3hPYzN3ZkVWQy9hTFFmRnZ2a1BPV2VWOXdaRFRPdUU2d1lBQnFTZ2R5bk5XYjlmUzZCV21ucDkvZ2VPClN6NHAxdmt1Sk9rY1VkUHNMUDV6MFkzZmpKa3owL1A4aUZtN0RaUHhlZDFZZW5ZYVFnNVZiOFpSWFIzWDA2bXYKTmtoU01Ib3l3U1JMa2xhOHo1eWxwQzhJcUVEWnhqZFl4eDBza3lFN3Y3RmRoZ2pIL2lUTkFVSkdKcGdXMlFJRApBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWFZd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFCkZnUVUrOXpYdlltZ1R4VFUrQkU4Q21sSnNQb3BJSlV3RFFZSktvWklodmNOQVFFTEJRQURnZ0dCQUdVRGVkZkkKeTdnYmgvZDJ0a1lLRkRGMVZNY1MzWWRJeUYxWkV2Z2Eya2lVaGMzeW4zUUhmT0pyV29abXl2V2Zpdlg4NFQzSApnQWNGeXdXRjhucG50d3N4NW1mODcwajB1ZmQ5eDI2bktBL05ZMm9FY0RldENVTTd0NDdHejNETTN6dWlVRnAvCnYxNFJNR29keUR2TnhTVlIvR1R3VjhSL2l6b0NvMTVYOERYRWtzazl4THhxWkFESG1FTFJoWW1IM1JudTZtcmYKSk9xcUh6amlxVk8ybVJkRk0wZlNOSGx6N21RQXdtMThqcHVjZjJrT1Y2ODZLQnpwZDlrb3hBN0pDTkVqdldiRgpQZlNYQm9ublVrZDgxWThLOTNpZlk0YzljL1lyUGRKNWRKZm9YUWoxRGVkTFZEWXc4RHVyNyt6akVjMjZPRkhHCituTUVWYWNzc2piTVRIWjN1VGEreTdqNGlwZE9HY2tCRWVEM0pIc1RmQlc3dWgrbGU2U0xOYk1wL0ZSWjhiTTcKNmFKLzBCZUhUWkN4N29hVTVrQ0ZmWjc2MXlPdTJxWHB6d1d6UThtb0d1SjcwaStIRDNvVHV6NWhFLzExelBzbQpvUGoxbW9uSlJEb083ajMzRllZM0RTZDI1dGFHbHFNMGd2VzlFUS84NlRFQjExSnBxWERxeDB0WS9BPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
