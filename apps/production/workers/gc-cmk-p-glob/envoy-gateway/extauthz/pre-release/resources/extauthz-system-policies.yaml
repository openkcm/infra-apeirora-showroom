resources:
  extauthz-system-policies:
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: extauthz-system-policies
    immutable: false
    data:
      systems.cedar: |-
        // Technical system based on x509 for automation tests
        permit (
          principal,
          action in [Action::"GET"],
          resource is Route
        ) when {
          principal in [
              Subject::"CN=automation,L=9999-TEST-CSGE,OU=a45b537c-3e0c-4403-9a42-17fb5ad59215,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
              Subject::"CN=automation,L=9999-TEST-CSGE,OU=bfe87081-75e2-473a-bbf8-e4f80d7e4175,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE"
          ]
          && context.type == "x509"
          && context.route like "*/echo/*"
        };
        // Technical system based on JWT for automation tests
        permit (
          principal,
          action in [Action::"GET"],
          resource is Route
        ) when {
          principal in [
              Subject::"c43fa18a-efb0-46bc-a97c-fbfe926d17ed"
          ]
          && context.type == "jwt"
          && context.route like "*/echo/*"
          && context.issuer == "https://kms20cmk1.accounts400.ondemand.com"
        };

        // BTP Subscription Manager based on x509
        permit (
          principal,
          action in [Action::"GET", Action::"PUT", Action::"POST", Action::"DELETE"],
          resource is Route
        ) when {
          principal in [
            Subject::"CN=Subscription Manager,L=sap-provisioning,OU=Certificate Service,OU=Subscription Manager,O=SAP Trust Community,C=DE",
            Subject::"CN=Subscription Manager,L=Subscription Manager,OU=sap-provisioning,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
            Subject::"CN=exampleapp_99_eu10-canary_csg,L=9999-TEST-CSGE,OU=2dfd8089-3c3c-47a4-ae67-3abaf016908a,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE"
          ]
          && context.type == "x509"
          && context.route like "*/callback/v1/tenants/*"
        };
        // BTP cockpit service api x509
        permit (
          principal,
          action in [Action::"GET", Action::"PUT", Action::"POST", Action::"DELETE"],
          resource is Route
        ) when {
          principal in [
            Subject::"CN=exampleapp_99_eu10-canary_csg,L=9999-TEST-CSGE,OU=2dfd8089-3c3c-47a4-ae67-3abaf016908a,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
            Subject::"CN=SAP BTP Cockpit Client For KMS,L=accounts.sap.com,OU=SAP BTP Cockpit Client,OU=SAP Cloud Platform Clients,O=SAP,C=DE"
          ]
          && context.type == "x509" &&
          (
            context.route like "*/v1/tenants*" ||
            context.route like "*/v1/link/*" ||
            context.route like "*/v1/unlink/*" ||
            context.route like "*/v1/linkedTenant/*"
          )
        };
        // Registry Service
        permit (
            principal,
            action in [Action::"GET", Action::"PUT", Action::"POST", Action::"DELETE"],
            resource is Route
        ) when {
            principal in [
                Subject::"CN=V1..DEVEL/ISM/AppTU:3694d615-69a3-4fb1-8d04-18eaffcd421c,L=DEVEL/KMS:3694d615-69a3-4fb1-8d04-18eaffcd421c,OU=fa5479eb-cc52-4605-a99e-be1af660f698,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=SAP BTP Cockpit Client For KMS,L=accounts.sap.com,OU=SAP BTP Cockpit Client,OU=SAP Cloud Platform Clients,O=SAP,C=DE",
                Subject::"CN=private-cmk-mocks-go,L=Frankfurt,OU=75234043-d387-4c11-928e-3e3b4facc7ea,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=private-cmk-mocks-go,L=Frankfurt,OU=413aebc7-ac56-474b-b83e-f98befaf2a71,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=sapkms-ks,L=Frankfurt,OU=4ca4a2fb-f8ed-4ca8-92c4-57ac972cc6c2,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=sapkms-ks,L=eu10-canary,OU=413aebc7-ac56-474b-b83e-f98befaf2a71,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=sapkms-ks,L=us31,OU=2fa5347e-4daf-478b-a95b-5f4725c20283,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=sapkms-ks,L=eu30,OU=6032221c-48ce-4c8a-a44b-c14da5826229,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=sapkms-ks,L=eu12,OU=08c53948-fc3e-4a3c-94eb-37640531080c,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=mesh,L=kms20:cmk:canary,OU=554e9d05-3818-4a8b-968d-080f4802e123,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=aws-us-01,L=kms20:cmk:canary,OU=41d21508-6a35-441b-a5ed-7ca46c619b84,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=aws-eu-01,L=kms20:cmk:canary,OU=89ce5968-95e6-4bde-9bca-c5820f6f64fa,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=gcp-eu-01,L=kms20:cmk:canary,OU=89ce5968-95e6-4bde-9bca-c5820f6f64fa,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=exampleapp_99_eu10-canary_csg,L=9999-TEST-CSGE,OU=2dfd8089-3c3c-47a4-ae67-3abaf016908a,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
                Subject::"CN=private-I538413,L=9999-PRIVATE-CERT,OU=6425e3f7-7c06-4b76-a2aa-0ed4f5d67edb,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE"
            ]
            && context.type == "x509"
            && context.route like "*/kms.api.cmk.registry.*.v1.Service/*"
        };
        //spis
        permit (
          principal,
          action in [Action::"PATCH"],
          resource is Route
        ) when {
          principal in [
              Subject::"CN=cmp-stage,L=Stage,OU=cmp-cf-eu10-canary,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE",
              Subject::"CN=exampleapp_99_eu10-canary_csg,L=9999-TEST-CSGE,OU=2dfd8089-3c3c-47a4-ae67-3abaf016908a,OU=Canary,OU=SAP Cloud Platform Clients,O=SAP SE,C=DE"
          ]
          && context.type == "x509"
          && context.route like "*/v1/tenantMappings/*"
        };
        permit (
          principal == Subject::"fa6725f0-017c-4052-8680-e95301db4fd5",
          action in [Action::"POST"],
          resource is Route
        ) when {
          context.type == "jwt"
          && context.route like "*/spfi/notify*"
          && context.issuer == "https://up.accounts.ondemand.com"
        };
